name: run game Y 1
run-name: ${{ github.actor }} - build
on:
  issues:
    types: [opened]
jobs:
    build:
      if: contains(github.event.issue.title, 'gpu')
      runs-on: ubuntu-latest
      steps:
        - uses: actions/checkout@v4
        - run: gh issue comment ${{ github.event.issue.number }} -b "‚è≥ The game starts, please wait a few seconds, I'm a fast robot, don't worry!"
          env:
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
            ISSUE: ${{ github.event.issue.html_url }}

        - name: Set up JDK
          uses: actions/setup-java@v3
          with:
            java-version: '17'
            distribution: 'temurin'
            architecture: x64

        - name: Setup Gradle
          uses: gradle/gradle-build-action@v2.8.1

        - name: Make gradlew executable on github action (or perm denied) and executed the game
          run: |
            chmod +x ./gradlew 
            UPDATE_GH=true
            TITLE_ISSUE=${{github.event.issue.title}}
            if [ "$TITLE_ISSUE" == *"pos_"* ]; then
              if [ "$TITLE_ISSUE" == *"pos_1"* ]; then
                ./gradlew run --args="action_github position_1"
              elif [ "$TITLE_ISSUE" == *"pos_2"* ]; then
                ./gradlew run --args="action_github position_2"
              elif [ "$TITLE_ISSUE" == *"pos_3"* ]; then
                ./gradlew run --args="action_github position_3"
              elif [ "$TITLE_ISSUE" == *"pos_4"* ]; then
                ./gradlew run --args="action_github position_4"
              elif [ "$TITLE_ISSUE" == *"pos_5"* ]; then
                ./gradlew run --args="action_github position_5"
              elif [ "$TITLE_ISSUE" == *"pos_6"* ]; then
                ./gradlew run --args="action_github position_6"
              elif [ "$TITLE_ISSUE" == *"pos_7"* ]; then
                ./gradlew run --args="action_github position_7"
              else
                UPDATE_GH=false
                gh issue comment ${{ github.event.issue.number }} -b "‚ùå Your choice is invalid, the title must contain the word `pos_1` or `pos_2`, `pos_3`, `pos_4`, `pos_5`, `pos_6`, `pos_7`. I'm sorry, try again.."
              fi
            else
              UPDATE_GH=false
              gh issue comment ${{ github.event.issue.number }} -b "‚ùå Your choice is invalid, the title must contain the word `pos_1` or `pos_2`, `pos_3`, `pos_4`, `pos_5`, `pos_6`, `pos_7`. I'm sorry, try again.."
            fi
            
            if [ $UPDATE_GH ]; then
              ./gradlew updateReadmeImage
              git config --local user.email "github-actions[bot]@users.noreply.github.com"
              git config --local user.name "github-actions[bot]"
              git add .
              git commit -m "update dist after build (github-actions)"
              gh issue close ${{ github.event.issue.number }} -c "‚úÖ Thanks for participating, the image generation is in progress, refresh the readme after a few minute!<h1>üîó<a href='https://github.com/tmslpm/GamePowerUnlimited#-game-power-unlimited-' title='Click here to go on readme'>GO TO README</a></h1>"
            else
              gh issue close ${{ github.event.issue.number }} -c "‚õî Failled.. you can try again if you wish, open a new isssues with the tile."
            fi 
          env:
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
            ISSUE: ${{ github.event.issue.html_url }}

        - name: Make Github push
          uses: ad-m/github-push-action@master
          with:
            github_token: ${{ secrets.GITHUB_TOKEN }}
            branch: main